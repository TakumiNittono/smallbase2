# 進捗管理

最終更新: 2024-XX-XX

---

## 全体進捗

```
[████████████████░░░░] 80% 完了
```

**Phase 1、Phase 2、Phase 3のコード実装は完了しました。動作確認と最終調整が残っています。**

---

## Phase 1: 基盤構築

**ステータス**: 🟡 進行中

### 1.1 Supabaseプロジェクト作成・設定
- [ ] Supabaseプロジェクト作成
- [ ] プロジェクトURL取得
- [ ] APIキー取得
- [ ] 環境変数設定

**備考**: ユーザーが手動でSupabaseプロジェクトを作成する必要があります。`backend/SETUP.md`を参照してください。 

---

### 1.2 データベーステーブル作成
- [x] SQLファイル作成（`docs/init_db.sql`）
- [ ] `files`テーブル作成（Supabaseで実行が必要）
- [ ] `chunks`テーブル作成（Supabaseで実行が必要）
- [ ] pgvector拡張有効化（Supabaseで実行が必要）
- [ ] インデックス作成（Supabaseで実行が必要）
- [ ] 外部キー制約設定（SQLに含まれています）

**備考**: `docs/init_db.sql`を作成しました。SupabaseのSQL Editorで実行してください。 

---

### 1.3 FastAPIプロジェクト作成
- [x] プロジェクトディレクトリ作成
- [x] `requirements.txt`作成
- [x] `main.py`作成
- [x] `config.py`作成
- [x] `.gitignore`作成
- [x] 仮想環境作成（完了）
- [x] 依存パッケージインストール（完了）
- [x] サーバー起動確認（完了）

**備考**: 基本構造は完成しました。サーバーは正常に起動しています（http://localhost:8000）。 

---

### 1.4 認証機能実装
- [x] Supabaseクライアント初期化（`supabase_client.py`）
- [x] ログインエンドポイント実装（`routers/auth.py`）
- [x] JWTトークン検証ミドルウェア作成（`auth.py`）
- [x] 管理者ロールチェック関数作成（`auth.py`）
- [x] コード実装完了（動作確認はSupabase設定後）

**備考**: 認証機能の実装は完了しました。Supabaseで管理者ユーザーを作成してテストしてください。 

---

## Phase 2: 管理者機能

**ステータス**: 🟡 実装完了（動作確認待ち）

### 2.1 ログイン画面実装
- [x] HTMLファイル作成（`frontend/admin/login.html`）
- [x] Bootstrapフォーム実装
- [x] ログインAPI呼び出し実装
- [x] トークン保存実装
- [x] リダイレクト実装
- [ ] 動作確認（Supabase設定後）

**備考**: ログイン画面の実装は完了しました。

---

### 2.2 ファイル一覧表示機能
- [x] `GET /admin/files`エンドポイント実装
- [x] 認証ミドルウェア適用
- [x] HTMLファイル作成（`frontend/admin/index.html`）
- [x] 一覧取得API呼び出し実装
- [x] テーブル表示実装
- [ ] 動作確認（Supabase設定後）

**備考**: ファイル一覧表示機能の実装は完了しました。

---

### 2.3 ファイルアップロード機能
- [x] `POST /admin/upload`エンドポイント実装
- [x] ファイル形式チェック実装
- [x] Supabase Storage保存実装
- [x] データベース保存実装
- [x] フロントエンドフォーム実装
- [ ] 動作確認（Supabase Storage設定後）

**備考**: ファイルアップロード機能の実装は完了しました。Supabase Storageに「files」バケットを作成する必要があります。

---

### 2.4 ファイル削除機能
- [x] `DELETE /admin/files/{id}`エンドポイント実装
- [x] ファイル削除処理実装
- [x] 関連チャンク削除確認（CASCADE削除）
- [x] Storage削除実装
- [x] フロントエンド削除ボタン実装
- [ ] 動作確認（Supabase設定後）

**備考**: ファイル削除機能の実装は完了しました。 

---

## Phase 3: RAG機能

**ステータス**: 🟡 実装完了（動作確認中）

### 3.1 テキスト抽出・チャンク分割実装
- [x] PDFテキスト抽出実装（`utils/text_extractor.py`）
- [x] DOCXテキスト抽出実装（`utils/text_extractor.py`）
- [x] TXT読み込み実装（`utils/text_extractor.py`）
- [x] チャンク分割ロジック実装（500文字、100文字オーバーラップ）
- [x] 動作確認（ファイルアップロード時に自動実行）

**備考**: テキスト抽出・チャンク分割機能の実装は完了しました。

---

### 3.2 Embedding生成・保存実装
- [x] OpenAI APIクライアント設定（`utils/embedding.py`）
- [x] Embedding生成関数実装
- [x] チャンクごとのEmbedding生成実装（バッチ処理対応）
- [x] pgvector保存実装（ファイルアップロード時に自動実行）
- [ ] 動作確認（チャンクが正しく保存されているか確認）

**備考**: Embedding生成・保存機能の実装は完了しました。

---

### 3.3 類似度検索実装
- [x] 質問文Embedding生成実装（`routers/chat.py`）
- [x] pgvector類似度検索実装（Python側でコサイン類似度計算）
- [x] 上位N件取得実装（上位5件）
- [ ] 動作確認（RAG質問が動作するか確認）

**備考**: 類似度検索機能の実装は完了しました。本番環境ではPostgreSQL関数を使用することを推奨します。

---

### 3.4 質問回答機能実装
- [x] `POST /chat`エンドポイント実装（`routers/chat.py`）
- [x] プロンプト構築実装
- [x] OpenAI Chat API呼び出し実装（gpt-4o-mini）
- [x] 回答とソース情報返却実装
- [x] フロントエンド質問画面実装（`frontend/index.html`）
- [ ] 動作確認（RAG質問が動作するか確認）

**備考**: 質問回答機能の実装は完了しました。 

---

## Phase 4: デプロイ

**ステータス**: 🔴 未着手

### 4.1 Azure Static Web Apps設定
- [ ] Static Web Appsリソース作成
- [ ] GitHubリポジトリ連携
- [ ] ビルド設定作成
- [ ] 環境変数設定
- [ ] 動作確認

**備考**: 

---

### 4.2 本番環境デプロイ
- [ ] FastAPIデプロイ
- [ ] 環境変数設定
- [ ] CORS設定
- [ ] 動作確認

**備考**: 

---

### 4.3 動作確認
- [ ] 管理者ログイン確認
- [ ] ファイルアップロード確認
- [ ] ファイル削除確認
- [ ] RAG質問確認
- [ ] エラーハンドリング確認

**備考**: 

---

## MVP完成条件チェックリスト

- [ ] 管理者ログインできる
- [ ] ナレッジ追加できる（PDF/TXT/DOCX対応）
- [ ] ナレッジ削除できる
- [ ] 削除時にチャンク・embeddingも同時に削除される
- [ ] ユーザー画面でRAG質問ができる
- [ ] ナレッジ追加・削除がユーザー画面に即反映される

---

## 課題・メモ

### 課題
- 

### メモ
- 

---

## 変更履歴

| 日付 | 変更内容 | 担当 |
|------|---------|------|
| 2024-XX-XX | 進捗管理ファイル作成 | - |

